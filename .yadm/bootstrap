#!/bin/sh

# Update system sources
sudo apt-get update

# Install Tools
dpkg-query -l | grep -qwi git || sudo apt-get --yes install git
dpkg-query -l | grep -qwi zsh || sudo apt-get --yes install zsh
dpkg-query -l | grep -qwi "less" || sudo apt-get --yes install "less"
dpkg-query -l | grep -qwi neovim || sudo apt-get --yes install neovim
dpkg-query -l | grep -qwi rxvt-unicode || sudo apt-get --yes install rxvt-unicode

# Install powerline patched fonts
if [ ! -f "$HOME/.local/share/fonts/Inconsolata for Powerline.otf" ]; then
    git clone https://github.com/powerline/fonts.git fonts
    cd fonts
    ./install.sh
    cd ..
    rm -rf fonts
fi

# Install prezto for zsh
if [ ! -f "$HOME/.zprezto/README.md" ]; then
    zsh
    git clone --recursive https://github.com/sorin-ionescu/prezto.git "${ZDOTDIR:-$HOME}/prezto"

    setopt EXTENDED_GLOB
    for rcfile in "${ZDOTDIR:-$HOME}"/.zprezto/runcoms/^README.md(.N); do
      ln -s "$rcfile" "${ZDOTDIR:-$HOME}/.${rcfile:t}"
    done

    cp -rln "${ZDOTDIR:-$HOME}/prezto" "${ZDOTDIR:-$HOME}/.zprezto"
    rm -rf "${ZDOTDIR:-$HOME}/prezto"
    exit
fi

# Set the system editor
if [ "$EDITOR" != "nvim" ]; then
    export EDITOR="nvim"
fi
if [ "$VISUAL" != "nvim" ]; then
    export VISUAL="nvim"
fi

# Set the system pager
if [ "$PAGER" != "less" ]; then
    export PAGER="less"
fi
