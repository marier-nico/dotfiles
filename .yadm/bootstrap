#!/bin/sh

# Update system sources
sudo apt-get update

# Install Tools
dpkg-query -l | grep -qwi git || sudo apt-get --yes install git
dpkg-query -l | grep -qwi zsh || (sudo apt-get --yes install zsh && chsh -s /bin/zsh)
dpkg-query -l | grep -qwi "less" || sudo apt-get --yes install "less"
dpkg-query -l | grep -qwi neovim || sudo apt-get --yes install neovim
dpkg-query -l | grep -qwi fontconfig || sudo apt-get --yes install fontconfig
dpkg-query -l | grep -qwi rxvt-unicode || sudo apt-get --yes install rxvt-unicode

# Install powerline patched fonts
temp_dir=$(mktemp -d)
if [ ! -f "$HOME/.local/share/fonts/Inconsolata for Powerline.otf" ]; then
    git clone https://github.com/powerline/fonts.git "$temp_dir/fonts"
    $temp_dir/fonts/install.sh
    rm -rf "$temp_dir"
fi

# Install prezto for zsh
temp_dir=$(mktemp -d)
if [ ! -f "$HOME/.zprezto/README.md" ]; then
    git clone --recursive https://github.com/sorin-ionescu/prezto.git "$temp_dir/.zprezto"

    zsh "$HOME/.yadm/mk-prezto-links"

    cp -rln "$temp_dir/.zprezto" "${ZDOTDIR:-$HOME}"
    rm -rf "$temp_dir"
fi

# Set permissions
chmod 755 "$HOME/.local"
chmod 755 "$HOME/.local/share"
chmod -R 755 "$HOME/.local/share/fonts"
chmod -R 755 "$HOME/.config"
chmod -R 755 "$HOME/.yadm"
chmod -R 755 "$HOME/.zprezto"
