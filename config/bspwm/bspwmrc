#!/bin/sh

#
# set URxvt config
#
xrdb ~/.Xresources

#
# kill running programs
#
xscreensaver-command -exit
killall polybar
killall sxhkd
for i in $(seq 1 $(bspc rule -l | wc -l));
do
	bspc rule -r head
done

#
# apply monitor-specific config
#
lineCount=$(xrandr --query | grep -i "\bconnected" | awk '{print $1}' | wc -l)
lines=$(xrandr --query | grep -i "\bconnected" | awk '{print $1}')
if [ $lineCount -eq 1 ]; then
	source $HOME/.config/arandr/laptop-layout.sh
	bspc monitor "$(cut -d$'\n' -f1 <<<"$lines")" -d 一 二 三 四 五 六 七 八 九 十
	polybar left &

	bspc rule -a "TelegramDesktop"	-o desktop='^10'
	bspc rule -a "Firefox"		-o desktop='^2'
	bspc rule -a "URxvt"		-o desktop='^1'
elif [ $lineCount -eq 2 ]; then
	source $HOME/.config/arandr/home-layout.sh
	bspc monitor "$(cut -d$'\n' -f1 <<<"$lines")" -d 一 二 三 四 五
	bspc monitor "$(cut -d$'\n' -f2 <<<"$lines")" -d 六 七 八 九 十
	polybar left &
	polybar right &

	bspc rule -a "TelegramDesktop"	-o desktop='^1'
	bspc rule -a "Firefox"		-o desktop='^7'
	bspc rule -a "URxvt"		-o desktop='^6'
else
	source $HOME/.config/arandr/laptop-layout.sh
	bspc monitor "$(cut -d$'\n' -f1 <<<"$lines")" -d 一 二 三 四 五 六 七 八 九 十
	polybar left &

	bspc rule -a "TelegramDesktop"	-o desktop='^10'
	bspc rule -a "Firefox"		-o desktop='^2'
	bspc rule -a "URxvt"		-o desktop='^1'
fi

#
# start monitor-agnostic programs
#
sxhkd &
compton &
xscreensaver &
telegram-desktop &
feh --no-fehbg --bg-fill $HOME/Pictures/wallpapers/japanese-crosswalk.jpg
if [ ! $(pidof firefox) ]; then
	firefox &
fi
if [ ! $(pidof urxvt) ]; then
	urxvt &
fi
if [ ! $(pidof srandrd) ]; then
	srandrd $HOME/.config/bspwm/bspwmrc &
fi

#
# set bspwm config
#
bspc config border_width		4
bspc config normal_border_color		"#434a5a"
bspc config focused_border_color	"#bd2c40"
bspc config window_gap			8

bspc config split_ratio			0.52
bspc config borderless_monocle		true
bspc config gapless_monocle		true

#
# bspwm rule examples
#
#bspc rule -a Gimp desktop='^8' state=floating follow=on
#bspc rule -a Chromium desktop='^2'
#bspc rule -a mplayer2 state=floating
#bspc rule -a Kupfer.py focus=on
#bspc rule -a Screenkey manage=off
